var canvas1,contex1,canvas2,contex2,canvas3,contex3,heightCanvas1,widthCanvas1,heightCanvas2,widthCanvas2,heightCanvas3,widthCanvas3,largeur=0,hauteur=0,xClient=0,yClient=0,xBouton=0,yBouton=0,longeurBouton=0,largeurBouton=0,xJoy=0,yJoy=0,xJoyMouvement=0,yJoyMouvement=0,rayonInterieur=0,rayonExterieur=0,jj=!1,jooy=!1,bout=!1,dessine=!1,dist=0,pi=Math.PI,i=0,servPosX=0,servPosY=0,posJX=0,posJY=0;function chargementfini(){canvas1=document.getElementById("canvas1"),context1=canvas1.getContext("2d"),canvas2=document.getElementById("canvas2"),context2=canvas2.getContext("2d"),canvas3=document.getElementById("canvas3"),context3=canvas3.getContext("2d"),document.addEventListener("touchstart",debut),document.addEventListener("touchmove",debut),canvas2.addEventListener("touchend",finBouton),canvas2.addEventListener("touchcancel",finBouton),canvas3.addEventListener("touchend",finJoy),canvas3.addEventListener("touchcancel",finJoy),document.body.className+=" charger",window.addEventListener("resize",redimentionne),redimentionne(),miniMap()}function redimentionne(){largeur=window.innerWidth-10,hauteur=window.innerHeight-10,canvas1.width=largeur,canvas1.height=.5*hauteur,largeur>hauteur?(canvas2.width=.5*largeur,canvas2.height=.5*hauteur,longeurBouton=.5*canvas2.height,largeurBouton=.5*canvas2.width,xBouton=.5*canvas2.width-.5*largeurBouton,yBouton=.5*canvas2.height-.5*longeurBouton,canvas3.width=.5*largeur,canvas3.height=.5*hauteur,rayonInterieur=.3*canvas3.height,rayonExterieur=rayonInterieur+5,xJoy=.5*canvas3.width,yJoy=.5*canvas3.height,bouton(),joystick()):(canvas2.width=.5*largeur,canvas2.height=.5*hauteur,longeurBouton=.5*canvas2.width,largeurBouton=.5*canvas2.height,xBouton=.5*canvas2.width-.5*largeurBouton,yBouton=.5*canvas2.height-.5*longeurBouton,canvas3.width=.5*largeur,canvas3.height=.5*hauteur,rayonInterieur=.3*canvas3.width,rayonExterieur=rayonInterieur+5,xJoy=.5*canvas3.width,yJoy=.5*canvas3.height,bouton(),joystick()),heightCanvas1=document.getElementById("canvas1").clientHeight,widthCanvas1=document.getElementById("canvas1").clientWidth,heightCanvas2=document.getElementById("canvas2").clientHeight,widthCanvas2=document.getElementById("canvas2").clientWidth,heightCanvas3=document.getElementById("canvas3").clientHeight,widthCanvas3=document.getElementById("canvas3").clientWidth}function debut(t){dessine=!0,utiliser(t)}function finBouton(t){dessine=!1,bout=!1,utiliser(t)}function finJoy(t){dessine=!1,jj=!1,jooy=!1,vitesse=0,envoyerDirection(0,0),utiliser(t)}function bouton(){context2.clearRect(0,0,widthCanvas2,heightCanvas2),context2.fillStyle="rgba(100, 0, 0, 1)",context2.fillRect(xBouton,yBouton,largeurBouton,longeurBouton),context2.fillStyle="rgba(0, 0, 0, 1)",context2.fillRect(xBouton+5,yBouton+5,largeurBouton-10,longeurBouton-10),context2.lineWidth="5",context2.strokeStyle="rgba(140, 0, 0, 1)",context2.strokeRect(xBouton+5,yBouton+5,largeurBouton-10,longeurBouton-10)}function boutonA(){context2.clearRect(0,0,widthCanvas2,heightCanvas2),context2.fillStyle="rgba(100, 0, 0, 1)",context2.fillRect(xBouton,yBouton,largeurBouton,longeurBouton),context2.fillStyle="rgba(0, 0, 0, 0.5)",context2.fillRect(xBouton+5,yBouton+5,largeurBouton-10,longeurBouton-10),context2.lineWidth="5",context2.strokeStyle="rgba(240, 0, 0, 0.5)",context2.strokeRect(xBouton+5,yBouton+5,largeurBouton-10,longeurBouton-10),bout=!0}function joystick(){context3.clearRect(0,0,widthCanvas3,heightCanvas3),context3.beginPath(),context3.fillStyle="rgba(100, 0, 0, 1)",context3.arc(xJoy,yJoy,rayonExterieur,0,2*pi),context3.fill(),context3.closePath(),context3.beginPath(),context3.fillStyle="rgba(0, 0, 0, 1)",context3.arc(xJoy,yJoy,rayonInterieur,0,2*pi),context3.fill(),context3.closePath(),context3.beginPath(),context3.strokeStyle="rgba(140, 0, 0, 1)",context3.lineWidth="5",context3.arc(xJoy,yJoy,rayonInterieur+1,0,2*pi),context3.stroke(),context3.closePath()}function joystickA(t,e){context3.clearRect(0,0,widthCanvas3,heightCanvas3),context3.beginPath(),context3.fillStyle="rgba(100, 0, 0, 1)",context3.arc(xJoy,yJoy,rayonExterieur,0,2*pi),context3.fill(),context3.closePath(),context3.beginPath(),context3.fillStyle="rgba(0, 0, 0, 0.5)",context3.arc(t,e,rayonInterieur,0,2*pi),context3.fill(),context3.closePath(),context3.beginPath(),context3.strokeStyle="rgba(240, 0, 0, 0.5)",context3.lineWidth="5",context3.arc(t,e,rayonInterieur+1,0,2*pi),context3.stroke(),context3.closePath(),jooy=!0}function miniMap(){servPosX=getPosX(),servPosY=getPosY(),posJX=servPosX*widthCanvas1,posJY=servPosY*heightCanvas1,context1.clearRect(0,0,widthCanvas1,heightCanvas1),context1.beginPath(),context1.fillStyle="rgba(100, 100, 100, 1)",context1.arc(posJX,posJY,10,0,2*pi),context1.fill(),context1.closePath(),setInterval("miniMap()",10)}function utiliser(t){if(dessine){for(i=0;i<t.touches.length;i++)xClient=t.touches[i].clientX,yClient=t.touches[i].clientY,xClientJoy=xClient-largeur+widthCanvas2,yClientJoy=yClient-hauteur+heightCanvas1,xClient>0&&xClient<widthCanvas2&&xClient>xBouton+5&&xClient<xBouton+largeurBouton&&yClient>heightCanvas1+yBouton+5&&yClient<heightCanvas1+yBouton+longeurBouton&&(boutonA(),document.fullscreenElement||document.documentElement.requestFullscreen()),xClient>widthCanvas2&&xClient<largeur&&(angle=Math.atan2(yClientJoy-yJoy,xClientJoy-xJoy),(dist=Math.sqrt(Math.pow(xClientJoy-xJoy,2)+Math.pow(yClientJoy-yJoy,2)))<rayonExterieur?(vitesse=parseInt(dist/rayonExterieur*100,10),joystickA(xClientJoy,yClientJoy),jj=!0):jj&&(xJoyMouvement=rayonExterieur*Math.cos(angle)+xJoy,yJoyMouvement=rayonExterieur*Math.sin(angle)+yJoy,joystickA(xJoyMouvement,yJoyMouvement),angle<0&&(angle+=2*pi)));envoyerDirection(angle,vitesse)}jooy||joystick(),bout||bouton()}