<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <title>OS</title>
    <style>
      *{
	  margin:0;
	  padding:0;
      }
      body{
	  opacity: 0;
	  background-color: #000000;
	  -webkit-transition: opacity 1s ease-in;
	  -moz-transition: opacity 1s ease-in;
	  -o-transition: opacity 1s ease-in;
	  -ms-transition: opacity 1s ease-in;
	  transition: opacity 1s ease-in;
      }
      body.charger{
	  opacity: 1;
      }
      #canvas {
	 //background: url("os.png") center;
	 //background-repeat: no-repeat;
	 background-color: #000000;
	 width = 600px;
	 height = 800px;
      }
      p{
	  text-align: center
      }
    </style>
  </head>
  <body onload="chargementfini()">
    <canvas id="canvas">
      Votre navigateur ne supporte pas canvas effectuez une mise a jour.
    </canvas>
  </body>
  <script>
    /*
      fonctionnaliter : manette de jeu, jouable ecrant tactile ou souris
    */
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    /*dimention de la fenetre*/
    var largeur = 0, hauteur = 0;
    /*variable de configuration*/
    var dessiner = false;                                       //test si on est entraint de dessiner
    var jj = false;                                             //test d'entrer dans la boucle
    var xJoy = 250, yJoy = 600;                                 //position x,y joyistick
    var xClient = 0, yClient =0;                                //position souris ou tactile utilisateur
    var rayonM=55,rayonE=60;                                    //rayon millieu et exterieur joyistick
    var dist = 0;                                               //distnance d'un point avec un autre
    var pi = Math.PI;                                           //PI
    var xBouton=210,yBouton=200;                                //poisition x,y bouton
    var longeurBouton=160,largeurBouton=80;                     //largeur et longeur bouton
    //les ecouteurs des entrer ecrant tactile
    document.addEventListener('touchstart', debut);             //executer au toucher
    document.addEventListener('touchend', fin);                 //ececuter quand relacher
    document.addEventListener('touchcancel', fin);              //execution a l'interuption
    document.addEventListener('touchmove', mouvement);          //executer lors d'un mouvement sur l'ecrant
    /*executer lors du redimentionage de la fenetre*/
    window.addEventListener('resize', redimentionne);
    /*les ecouteur des entrer souris*/
    document.addEventListener('mousedown', debut);              //executer au click souris
    document.addEventListener('mouseup', fin);                  //executer lorsque la souris est relacher
    document.addEventListener('mousemove', mouvement);          //executer lorsqu'un mouvement de souris est effectuer
    /*lorsque le chargement est fini on fait apparaitre en fondu + les élément de la manette de base*/
    function chargementfini() {
	document.body.className += " charger";
	redimentionne();
	fond();
	joystick();
	bouton();
    }
    function redimentionne(){
	largeur = (window.innerWidth)-10;
	hauteur = (window.innerHeight)-10;
	canvas.width = largeur;
	canvas.height = hauteur;
	xJoy=(largeur/100)*65;
	yjoy=(hauteur/100)*80;
	xBouton=xJoy-(largeurBouton/2);
	yBouton=(hauteur/100)*20;
    }
    /*executer si un ecouteur de click est lancer*/
    function debut(event) {
	dessiner = true;
	mouvement(event);
    }
    /*executer si un ecouteur de relacher click est lancer*/
    function fin() {
	dessiner = false;
	fond();
	bouton();
	joystick();
    }
    /*le fond de la manette, encoche des boutons*/
    function fond(){    
	context.clearRect(0, 0, canvas.width, canvas.height);
	//joyistick
	context.beginPath();
	context.fillStyle="#ffffff"
	context.arc(xJoy, yJoy, rayonE, 0, 2 * pi);
	context.fill();
	context.closePath();
	//bouton
	context.fillRect(xBouton , yBouton, largeurBouton, longeurBouton);
    }
    /*joystick de base et joystickA lorsque selectionner*/
    function joystick(){
	context.beginPath();
	context.fillStyle="#555555"
	context.arc(xJoy, yJoy, rayonM, 0, 2 * pi);
	context.fill();
	context.closePath();
	context.beginPath();
	context.lineWidth="4";
	context.arc(xJoy, yJoy, rayonM, 0, 2 * pi);
	context.stroke();
	context.closePath();
    }
    function joystickA(event){
	context.beginPath();
	context.fillStyle="#333333";
	context.arc(event.clientX, event.clientY, rayonM, 0, 2 * pi);
	context.fill();
	context.closePath();
	context.beginPath();
	context.lineWidth="4";
	context.arc(event.clientX, event.clientY, rayonM, 0, 2 * pi);
	context.stroke();
	context.closePath();
    }
    /*bouton de base et boutonA lorsque selectionner*/
    function bouton(){
	context.fillStyle="#555555"
	context.fillRect(xBouton+5 , yBouton+5, largeurBouton-10, longeurBouton-10);
	context.strokeRect(xBouton+5 , yBouton+5, largeurBouton-10, longeurBouton-10);
    }
    function boutonA(){
	context.fillStyle="#333333";
	context.fillRect(xBouton+5 , yBouton+5, largeurBouton-10, longeurBouton-10);
	context.strokeRect(xBouton+5 , yBouton+5, largeurBouton-10, longeurBouton-10);
    }
    /*executer lorsque l'ecouteur de mouvement est lancer ou lors d'un apuis bouton, cette fonction est le coeur de la manette*/
    function mouvement(event) {
	if(dessiner){
	    xClient=event.clientX;
	    yClient=event.clientY;
	    if(((xClient>xBouton+5)&&(xClient<xBouton+largeurBouton-5))&&((yClient>yBouton+5)&&(yClient<yBouton+longeurBouton-5))){
		fond();
		boutonA();
		joystick();
	    }
	    dist=Math.sqrt(Math.pow(xClient-xJoy,2)+Math.pow(yClient-yJoy,2));
	    if(dist<rayonE+rayonM){
		fond();
		bouton();
		joystickA(event);
		jj = true;
	    }else{
		if(jj){
		    context.clearRect(0, 0, canvas.width, canvas.height);
		    fond();
		    bouton();
		    joystick();
		    jj = false;
		}
	    }
	}else{
	    context.clearRect(0, 0, canvas.width, canvas.height);
	    fond();
	    bouton();
	    joystick();
	}
    }
  </script>
</html> 
